<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Information Retrieval by Smaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50" x-data="unifiedApp()">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-graduation-cap text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">Information Retrieval by Smaran</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button @click="activeTab = 'search'" 
                                :class="activeTab === 'search' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-600'"
                                class="px-4 py-2 rounded-md font-medium transition-all">
                            <i class="fas fa-search mr-2"></i>Search
                        </button>
                        <button @click="activeTab = 'classify'" 
                                :class="activeTab === 'classify' ? 'bg-white shadow-sm text-purple-600' : 'text-gray-600'"
                                class="px-4 py-2 rounded-md font-medium transition-all">
                            <i class="fas fa-file-text mr-2"></i>Classify
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search Tab -->
        <div x-show="activeTab === 'search'" class="space-y-6">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Academic Search Engine</h2>
                <p class="text-gray-600">Search through academic publications and research papers</p>
            </div>

            <!-- Search Box -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input 
                        type="text" 
                        x-model="searchQuery"
                        @keyup.enter="performSearch()"
                        placeholder="Search for academic publications..."
                        class="block w-full pl-10 pr-48 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg"
                        autocomplete="off"
                    >
                    <div class="absolute inset-y-0 right-0 flex items-center space-x-2">
                        <button 
                            @click="showAdvancedSearch = !showAdvancedSearch"
                            class="text-gray-500 hover:text-blue-600 px-3 py-2 text-sm">
                            <i class="fas fa-cog mr-1"></i>Advanced
                        </button>
                        <button 
                            @click="performSearch()"
                            :disabled="searching"
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-6 py-2 rounded-md font-medium transition-colors">
                            <span x-show="!searching">Search</span>
                            <span x-show="searching" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Searching
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Advanced Search Options -->
                <div x-show="showAdvancedSearch" x-collapse class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Author</label>
                            <input 
                                type="text" 
                                x-model="searchFilters.author"
                                placeholder="Author name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                            <input 
                                type="text" 
                                x-model="searchFilters.year"
                                placeholder="e.g., 2020-2024"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Results per page</label>
                            <select x-model="resultsPerPage" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="10">10 results</option>
                                <option value="20">20 results</option>
                                <option value="50">50 results</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Results -->
            <div x-show="searchResults.length > 0" class="space-y-4">
                <!-- Search Stats -->
                <div class="flex items-center justify-between border-b pb-4">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-lg font-medium text-gray-900">Search Results</h3>
                        <span x-show="totalResults" class="text-sm text-gray-500" 
                              x-text="'Showing ' + searchResults.length + ' of ' + totalResults + ' results for \"' + searchQuery + '\"'"></span>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <i class="fas fa-clock"></i>
                        <span x-text="(searchTime * 1000).toFixed(0) + ' ms'"></span>
                    </div>
                </div>

                <!-- Results List -->
                <div class="space-y-6">
                    <template x-for="(result, index) in searchResults" :key="result.id">
                        <div class="border-b border-gray-200 pb-4 last:border-b-0">
                            <!-- Title -->
                            <div class="mb-2">
                                <a :href="result.link" target="_blank" 
                                   class="text-lg font-medium text-blue-600 hover:text-blue-800 hover:underline">
                                    <span x-text="result.title"></span>
                                </a>
                            </div>

                            <!-- Authors and Year -->
                            <div class="mb-2">
                                <span class="text-sm text-green-700 font-medium" x-text="Array.isArray(result.authors) ? result.authors.join(', ') : result.authors"></span>
                                <span class="text-sm text-gray-500"> - </span>
                                <span class="text-sm text-gray-500" x-text="result.year"></span>
                            </div>

                            <!-- Abstract -->
                            <p class="text-sm text-gray-700 leading-relaxed mb-2" x-text="result.abstract"></p>

                            <!-- Metadata -->
                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                <span x-show="result.relevancy" 
                                      class="px-2 py-1 bg-blue-100 text-blue-800 rounded"
                                      x-text="'Relevancy: ' + result.relevancy + '%'"></span>
                                <span x-show="result.matched_fields && result.matched_fields.length > 0"
                                      x-text="'Matched: ' + result.matched_fields.join(', ')"></span>
                                <a :href="result.link" target="_blank" class="text-blue-600 hover:underline">
                                    <i class="fas fa-external-link-alt mr-1"></i>View Full Paper
                                </a>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Bottom Search Stats & Load More -->
                <div class="pt-6 border-t">
                    <!-- Results Counter and Search Time -->
                    <div class="flex items-center justify-between mb-4 text-sm text-gray-500">
                        <div class="flex items-center space-x-4">
                            <span>
                                Showing <span x-text="searchResults.length"></span> of <span x-text="totalResults"></span> results
                            </span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-clock"></i>
                            <span x-text="(searchTime * 1000).toFixed(0) + ' ms'"></span>
                        </div>
                    </div>

                    <!-- Load More Button -->
                    <div x-show="totalResults > searchResults.length" class="text-center">
                        <button @click="loadMoreResults()" 
                                :disabled="searching"
                                class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors">
                            <span x-show="!searching">
                                <i class="fas fa-plus mr-2"></i>Load More Results
                            </span>
                            <span x-show="searching" class="flex items-center justify-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>Loading More...
                            </span>
                        </button>
                    </div>

                    <!-- All Results Loaded Message -->
                    <div x-show="totalResults <= searchResults.length && totalResults > 0" class="text-center text-sm text-gray-500">
                        <i class="fas fa-check-circle text-green-500 mr-1"></i>
                        All <span x-text="totalResults"></span> results loaded
                    </div>
                </div>
            </div>

            <!-- No Search Results -->
            <div x-show="searchQuery && searchResults.length === 0 && !searching" 
                 class="text-center py-8 text-gray-500">
                <i class="fas fa-search text-4xl mb-4"></i>
                <p>No results found for your search query.</p>
            </div>
        </div>

        <!-- Classify Tab -->
        <div x-show="activeTab === 'classify'" class="space-y-6">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Document Classifier</h2>
                <p class="text-gray-600">Classify documents into Politics, Business, or Health categories</p>
            </div>

            <!-- Classification Interface -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Input Section -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Enter Text to Classify</h3>
                        
                        <!-- Input Method Toggle -->
                        <div class="mb-4">
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" x-model="inputMethod" value="type" class="mr-2">
                                    <span>Type/Paste Text</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" x-model="inputMethod" value="example" class="mr-2">
                                    <span>Use Example</span>
                                </label>
                            </div>
                        </div>

                        <!-- Example Selector -->
                        <div x-show="inputMethod === 'example'" class="mb-4">
                            <select x-model="selectedExample" @change="classifyText = examples[selectedExample]" 
                                    class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="">Select an example...</option>
                                <template x-for="(text, key) in examples" :key="key">
                                    <option :value="key" x-text="key"></option>
                                </template>
                            </select>
                        </div>

                        <!-- Text Input -->
                        <textarea 
                            x-model="classifyText"
                            placeholder="Enter or paste your document text here..."
                            class="w-full h-40 p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 resize-none"
                        ></textarea>

                        <!-- Classify Button -->
                        <button 
                            @click="performClassification()"
                            :disabled="!classifyText.trim() || classifying"
                            class="mt-4 w-full bg-purple-600 hover:bg-purple-700 disabled:opacity-50 text-white px-6 py-3 rounded-md font-medium transition-colors">
                            <span x-show="!classifying">Classify Document</span>
                            <span x-show="classifying" class="flex items-center justify-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Classifying
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Classification Results</h3>
                        
                        <div x-show="classificationResult">
                            <!-- Prediction -->
                            <div class="mb-4">
                                <div class="text-center p-4 rounded-lg" 
                                     :class="getCategoryStyle(classificationResult?.prediction)">
                                    <div class="text-sm text-gray-600 mb-1">Category</div>
                                    <div class="text-xl font-bold" x-text="classificationResult?.prediction"></div>
                                </div>
                            </div>

                            <!-- Confidence -->
                            <div class="mb-4">
                                <div class="text-center p-3 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Confidence</div>
                                    <div class="text-lg font-semibold" 
                                         :class="getConfidenceColor(classificationResult?.confidence)"
                                         x-text="(classificationResult?.confidence * 100).toFixed(1) + '%'"></div>
                                </div>
                            </div>

                            <!-- Probability Breakdown -->
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-2">Probability Breakdown</h4>
                                <template x-for="(prob, category) in classificationResult?.probabilities" :key="category">
                                    <div class="mb-2">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span x-text="category"></span>
                                            <span x-text="(prob * 100).toFixed(1) + '%'"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" 
                                                 :style="`width: ${prob * 100}%`"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div x-show="!classificationResult" class="text-center text-gray-500 py-8">
                            <i class="fas fa-file-text text-4xl mb-4"></i>
                            <p>Enter text and click 'Classify Document' to see results!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center text-gray-600">
                <p class="mb-2">Unified Academic Tools - Search Engine + Document Classifier</p>
                <p class="text-sm">Powered by FastAPI • Built with modern web technologies</p>
            </div>
        </div>
    </footer>

    <script>
        function unifiedApp() {
            return {
                activeTab: 'search',
                
                // Search functionality
                searchQuery: '',
                searchResults: [],
                totalResults: 0,
                searchTime: 0,
                searching: false,
                showAdvancedSearch: false,
                searchFilters: {
                    author: '',
                    year: '',
                },
                resultsPerPage: 10,
                
                // Classification functionality
                classifyText: '',
                inputMethod: 'type',
                selectedExample: '',
                classificationResult: null,
                classifying: false,
                
                // Example texts
                examples: {
                    'Politics Example': 'The Senate voted 68-32 today to pass comprehensive immigration reform legislation that would provide a pathway to citizenship for millions of undocumented immigrants while significantly increasing border security funding. The bipartisan bill includes provisions for enhanced border patrol technology, additional immigration judges, and a merit-based system for future immigration.',
                    'Business Example': 'Apple Inc. reported record quarterly earnings that exceeded Wall Street expectations, with revenue reaching $89.5 billion driven by strong iPhone and Services sales. The tech giant\'s cloud services division saw particularly robust growth, with revenue increasing 31% year-over-year as enterprises continued digital transformation initiatives.',
                    'Health Example': 'Researchers at Johns Hopkins Medical School announced breakthrough results from a clinical trial testing a new gene therapy for sickle cell disease. The treatment, which modifies patients\' own stem cells to produce healthy hemoglobin, showed remarkable success in eliminating painful crises in 18 of 20 participants over a two-year follow-up period.'
                },

                async performSearch() {
                    if (!this.searchQuery.trim()) return;
                    
                    this.searching = true;
                    this.searchResults = [];
                    this.totalResults = 0;
                    
                    try {
                        const response = await fetch('/api/search', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                query: this.searchQuery,
                                num_results: this.resultsPerPage
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.searchResults = data.results || [];
                            this.totalResults = data.total_results || 0;
                            this.searchTime = data.search_time || 0;
                        } else {
                            console.error('Search failed:', response.statusText);
                        }
                    } catch (error) {
                        console.error('Search error:', error);
                    } finally {
                        this.searching = false;
                    }
                },

                async loadMoreResults() {
                    if (!this.searchQuery.trim() || this.searching) return;
                    
                    this.searching = true;
                    
                    try {
                        // Calculate how many results to request
                        const currentCount = this.searchResults.length;
                        const nextBatchSize = parseInt(this.resultsPerPage);
                        
                        const response = await fetch('/api/search', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                query: this.searchQuery,
                                num_results: currentCount + nextBatchSize
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.searchResults = data.results || [];
                            this.totalResults = data.total_results || 0;
                            this.searchTime = data.search_time || 0;
                        } else {
                            console.error('Load more failed:', response.statusText);
                        }
                    } catch (error) {
                        console.error('Load more error:', error);
                    } finally {
                        this.searching = false;
                    }
                },

                async performClassification() {
                    if (!this.classifyText.trim()) return;
                    
                    this.classifying = true;
                    this.classificationResult = null;
                    
                    try {
                        const response = await fetch('/api/classify', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                text: this.classifyText
                            })
                        });
                        
                        if (response.ok) {
                            this.classificationResult = await response.json();
                        } else {
                            console.error('Classification failed:', response.statusText);
                        }
                    } catch (error) {
                        console.error('Classification error:', error);
                    } finally {
                        this.classifying = false;
                    }
                },

                getCategoryStyle(category) {
                    const styles = {
                        'Politics': 'bg-blue-100 border-blue-300 text-blue-800',
                        'Business': 'bg-green-100 border-green-300 text-green-800',
                        'Health': 'bg-red-100 border-red-300 text-red-800'
                    };
                    return styles[category] || 'bg-gray-100 border-gray-300 text-gray-800';
                },

                getConfidenceColor(confidence) {
                    if (confidence >= 0.7) return 'text-green-600';
                    if (confidence >= 0.4) return 'text-yellow-600';
                    return 'text-red-600';
                }
            }
        }
    </script>
</body>
</html>